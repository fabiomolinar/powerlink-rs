services:
  # The Controlled Node (CN) service
  cn:
    build:
      context: ../../../../
      dockerfile: crates/powerlink-io-linux/tests/loopback_test_resources/Dockerfile
    container_name: powerlink-cn
    cap_add:
      - NET_RAW # Needed for pnet raw sockets
    environment:
      POWERLINK_TEST_ROLE: "CN"
      RUST_LOG: debug # Enable logging inside the container
    networks:
      powerlink_net:
        # Assign a static IP corresponding to the Node ID used in the test
        ipv4_address: 192.168.100.42
    # Ensure CN waits for MN to be ready (optional but good practice)
    depends_on:
      - mn

  # The Managing Node (MN) service
  mn:
    build:
      context: ../../../../
      dockerfile: crates/powerlink-io-linux/tests/loopback_test_resources/Dockerfile
    container_name: powerlink-mn
    cap_add:
      - NET_RAW # Needed for pnet raw sockets
    environment:
      POWERLINK_TEST_ROLE: "MN"
      RUST_LOG: debug # Enable logging inside the container
    networks:
      powerlink_net:
        # Assign the standard POWERLINK MN IP address
        ipv4_address: 192.168.100.240

networks:
  powerlink_net:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.100.0/24 # Define the POWERLINK subnet

